# ุณุฌู ุงูุชุบููุฑุงุช - TikTok Recorder Bot

## [ุฅุตูุงุญ - 15 ููููุจุฑ 2025]

### ๐ง ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:

#### 1. ุญู ูุดููุฉ ุฎุทุฃ 413 (Request Entity Too Large)
**ุงููุดููุฉ:** 
- ูุดู ุฑูุน ุงููููุงุช ุงููุจูุฑุฉ (ุฃูุซุฑ ูู 100 MB) ุฅูู Cloudinary
- ุธููุฑ ุฎุทุฃ: `Server returned unexpected status code - 413`

**ุงูุญู:**
- ุชุบููุฑ `cloudinary.uploader.upload()` ุฅูู `cloudinary.uploader.upload_large()`
- ุฅุถุงูุฉ `chunk_size: 20000000` (20 MB ููู ุฌุฒุก)
- ุฅุถุงูุฉ `timeout: 600000` (10 ุฏูุงุฆู)

**ุงูููู ุงููุนุฏู:** `src/services/cloudinary.service.js`

```javascript
// ูุจู ุงูุฅุตูุงุญ โ
const result = await cloudinary.uploader.upload(filePath, {...});

// ุจุนุฏ ุงูุฅุตูุงุญ โ
const result = await cloudinary.uploader.upload_large(filePath, {
    resource_type: "video",
    chunk_size: 20000000,
    timeout: 600000,
    ...
});
```

---

#### 2. ุญูุงูุฉ ุงููููุงุช ูู ุงูุญุฐู ูุจู ุฑูุนูุง ุจูุฌุงุญ
**ุงููุดููุฉ:**
- ูุงู ุงูููุฏ ูุญุฐู ุงููููุงุช ุงููุญููุฉ ุญุชู ูู ูุดู ุงูุฑูุน ุฅูู Cloudinary
- ููุฏุงู ุงูููุฏูููุงุช ูู ุญุงูุฉ ูุดู ุงูุฑูุน

**ุงูุญู:**
- ุฅุถุงูุฉ ูุชุบูุฑ `uploadSuccessful` ูุชุชุจุน ุญุงูุฉ ุงูุฑูุน
- ุงูุญุฐู ูุชู ููุท ูู `finally` block ุนูุฏ `uploadSuccessful === true`
- ุนุฑุถ ุฑุณุงูุฉ ุชุญุฐูุฑ ูููุณุชุฎุฏู ูู ุญุงูุฉ ูุดู ุงูุฑูุน
- ุงูุงุญุชูุงุธ ุจุงูููู ูุญููุงู ูุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุงุญูุงู

**ุงูููู ุงููุนุฏู:** `src/bot.js`

**ุขููุฉ ุงูุญูุงูุฉ:**
```javascript
let uploadSuccessful = false;

try {
    cloudinaryResult = await uploadVideo(finalMp4Path, username);
    uploadSuccessful = true; // โ ุชุฃููุฏ ุงููุฌุงุญ
    ...
} catch (error) {
    if (!uploadSuccessful) {
        // ๐ก๏ธ ูุง ุชุญุฐู ุงูููู - ุฃุจูุบ ุงููุณุชุฎุฏู
        return; 
    }
} finally {
    // ๐๏ธ ุงูุญุฐู ููุท ุนูุฏ ุงููุฌุงุญ
    if (uploadSuccessful && fs.existsSync(finalMp4Path)) {
        fs.unlinkSync(finalMp4Path);
    }
}
```

---

### ๐ ุชุฃุซูุฑ ุงูุฅุตูุงุญุงุช:

| ูุจู | ุจุนุฏ |
|-----|-----|
| โ ูุดู ุฑูุน ุงููููุงุช > 100 MB | โ ุฑูุน ูุงุฌุญ ูููููุงุช ุญุชู 10 GB |
| โ ุญุฐู ุงููููุงุช ุญุชู ุนูุฏ ูุดู ุงูุฑูุน | โ ุงูุญุฐู ููุท ุจุนุฏ ุชุฃููุฏ ูุฌุงุญ ุงูุฑูุน |
| โ ููุฏุงู ุงูููุฏูููุงุช | โ ุญูุธ ุขูู ูุน ุฅููุงููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ |

---

### ๐ฏ ููู ูุนูู ุงูุฑูุน ุงููุฌุฒุฃ:

```
ุงูููุฏูู (290 MB)
    โ
โโ Chunk 1:   0-20 MB   [โ]
โโ Chunk 2:  20-40 MB   [โ]
โโ Chunk 3:  40-60 MB   [โ]
โโ Chunk 4:  60-80 MB   [โ]
โโ Chunk 5:  80-100 MB  [โ]
โโ Chunk 6: 100-120 MB  [โ]
...
โโ Chunk 15: 280-290 MB [โ]
    โ
๐ฌ ุฅุนุงุฏุฉ ุชุฌููุน ุนูู Cloudinary
    โ
โ ุฑุงุจุท ุฏุงุฆู ููููุฏูู
```

---

### โ ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุตูุงุญ:

ุจุนุฏ ุชุทุจูู ุงูุฅุตูุงุญุงุชุ ูุฌุจ ุฃู ุชุฑู:

1. **ูู ุญุงูุฉ ูุฌุงุญ ุงูุฑูุน:**
```
[Cloudinary] ุจุฏุก ุฑูุน ุงูููู: /app/downloads/user_video.mp4
[Cloudinary] โ ุชู ุงูุฑูุน ุจูุฌุงุญ. ุงูุฑุงุจุท: https://...
[Cloudinary] ๐ ูุนุฑู ุงูููู: tiktok_records/...
[Upload] โ ุชู ุฑูุน ุงูููู ุจูุฌุงุญ ุฅูู Cloudinary
[Cleanup] ๐๏ธ ุญุฐู ุงูููู ุงููุญูู ุจุนุฏ ูุฌุงุญ ุงูุฑูุน
[Cleanup] โ ุชู ุญุฐู ุงูููู ุงููุญูู ุจูุฌุงุญ
```

2. **ูู ุญุงูุฉ ูุดู ุงูุฑูุน:**
```
[Cloudinary] โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฑูุน: {...}
โ ุฎุทุฃ ุฃุซูุงุก ุงูุฑูุน ุฃู ุงูุฅุฑุณุงู ุจุนุฏ ุงูุชุณุฌูู
[Safety] ๐ก๏ธ ุชู ุงูุงุญุชูุงุธ ุจุงูููู ูุนุฏู ูุฌุงุญ ุงูุฑูุน: /app/downloads/user_video.mp4
```

---

### ๐ ููุงุญุธุงุช ูููุฉ:

1. **ุญุฏ ุงูุฑูุน:**
   - ุงูุฎุทุฉ ุงููุฌุงููุฉ ูู Cloudinary ุชุฏุนู ุญุชู 10 GB ููู ููู ุจุงุณุชุฎุฏุงู `upload_large`

2. **ุงูุฃุฏุงุก:**
   - ุงูุฑูุน ุงููุฌุฒุฃ ุฃุจุทุฃ ููููุงู ูููู ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู
   - ูู chunk (20 MB) ูุณุชุบุฑู ุญูุงูู 5-30 ุซุงููุฉ ุญุณุจ ุณุฑุนุฉ ุงูุฅูุชุฑูุช

3. **ุงูุชุฎุฒูู ุงููุญูู:**
   - ูู ุญุงูุฉ ูุดู ุงูุฑูุนุ ุงููููุงุช ุชุจูู ูู ูุฌูุฏ `downloads/`
   - ูููู ุฅุนุงุฏุฉ ุฑูุนูุง ูุฏููุงู ุฃู ุจุณูุฑูุจุช ูููุตู

4. **ุงููุฑุงูุจุฉ:**
   - ุชุญูู ูู ูุณุงุญุฉ ุงูุชุฎุฒูู ุงููุชุงุญุฉ ุจุงูุชุธุงู
   - ุฑุงูุจ logs ููุชุฃูุฏ ูู ุนุฏู ุชุฑุงูู ุงููููุงุช ุบูุฑ ุงููุฑููุนุฉ

---

### ๐ ุฎุทูุงุช ุงูุชุดุบูู ุจุนุฏ ุงูุชุญุฏูุซ:

```bash
# 1. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุช
npm start

# 2. ุงุฎุชุจุงุฑ ูุน ุจุซ ูุจุงุดุฑ
# ูู ุจุชุณุฌูู ุจุซ ูุงุญุฏ ูุฑุงูุจ ุงู logs

# 3. ุชุญูู ูู ูุฌุงุญ ุงูุฑูุน
# ุชุฃูุฏ ูู ุธููุฑ ุฑุณุงูุฉ "โ ุชู ุงูุฑูุน ุจูุฌุงุญ" ูุจู ุฑุณุงูุฉ "๐๏ธ ุญุฐู ุงูููู"
```
