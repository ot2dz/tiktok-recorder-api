# ๐ฌ TikTok Live Recorder Bot

ุจูุช ุชููุฌุฑุงู ุฐูู ูุชุณุฌูู ุงูุจุซ ุงููุจุงุดุฑ ูู TikTok ุชููุงุฆูุงู ูุฑูุนู ุนูู Google Drive.

---

## โจ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ

### ๐ฅ ุชุณุฌููุงุช ูุชุนุฏุฏุฉ ูุชุฒุงููุฉ (NEW!)
- โ **ุชุณุฌูู 3 ุจุซูุซ ูุจุงุดุฑุฉ ูู ููุณ ุงูููุช**
- โ ุฃูุฑ `/list` ูุนุฑุถ ุฌููุน ุงูุชุณุฌููุงุช ุงููุดุทุฉ
- โ ุฃูุฑ `/stop <username>` ูุฅููุงู ุชุณุฌูู ูุญุฏุฏ
- โ ุฃูุฑ `/stop all` ูุฅููุงู ุฌููุน ุงูุชุณุฌููุงุช
- โ ุญูุงูุฉ ูู ุงูุชุณุฌููุงุช ุงูููุฑุฑุฉ
- โ ุนุฏุงุฏ ุญู ููู ุชุณุฌูู (ุงููุฏุฉุ ุงูุญุฌู)

๐ **ูููุฒูุฏ ูู ุงูุชูุงุตูู**: ุงูุฑุฃ [ุฏููู ุงูุชุณุฌููุงุช ุงููุชุนุฏุฏุฉ](./MULTI_RECORDING_GUIDE.md)

### โ๏ธ ุชูุงูู Cloudflare R2 + n8n
- โ ุฑูุน ุชููุงุฆู ุฅูู Cloudflare R2 (S3-compatible)
- โ n8n workflow ูุฑูุน ุฅูู Google Drive ุชููุงุฆูุงู
- โ ูุง ุญุงุฌุฉ ูุฅุฏุงุฑุฉ OAuth tokens ูุฏููุงู
- โ ุฅุดุนุงุฑุงุช ุชููุฌุฑุงู ุนูุฏ ุงูุชูุงู ุงูุฑูุน

### ๐ ุฅุฏุงุฑุฉ Token ุฐููุฉ
- โ Token ูุญููุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ููุณ ูู Environment Variables)
- โ ุชุญุฏูุซ Token ูู ุงูุชููุฌุฑุงู ูุจุงุดุฑุฉ ุจุฏูู ุฅุนุงุฏุฉ ุชุดุบูู
- โ ูุดู ุชููุงุฆู ูุงูุชูุงุก ุตูุงุญูุฉ Token ูุฅุฑุณุงู ุฅุดุนุงุฑ ููุฑู

### ๐ ุฅุฏุงุฑุฉ ุงูููุฏูููุงุช ุงููุงุดูุฉ
- โ ูุงุฆูุฉ ุงูุชุธุงุฑ ุฐููุฉ ููููุฏูููุงุช ุงูุชู ูุดู ุฑูุนูุง
- โ ุฅุนุงุฏุฉ ุฑูุน ูุฏููุฉ ุฃู ุชููุงุฆูุฉ ุจุนุฏ ุชุญุฏูุซ Token
- โ ุนุฑุถ ุชูุตููู ููููุฏูููุงุช ุงููุงุดูุฉ ูุน ุฃุฒุฑุงุฑ ุชูุงุนููุฉ
- โ ุฅุญุตุงุฆูุงุช ุดุงููุฉ ููุฑูุน (ูุฌุญ/ูุดู)

### ๐ณ ุฏุนู Docker & Coolify
- โ ูุณุงุฑุงุช ุฏููุงููููุฉ ุชุฏุนู Docker volumes
- โ ูุนูู ูุญููุงู ูุนูู Coolify ุจุฏูู ุชุนุฏูู

---

## ๐ ุงูุชุซุจูุช ุงูุณุฑูุน

### 1๏ธโฃ ุงููุชุทูุจุงุช
```bash
- Node.js 18+
- FFmpeg
- ุญุณุงุจ Google Cloud (ููุญุตูู ุนูู Client ID & Secret)
```

### 2๏ธโฃ ุงูุชุซุจูุช
```bash
git clone https://github.com/your-repo/tiktok-recorder-api.git
cd tiktok-recorder-api
npm install
```

### 3๏ธโฃ ุฅุนุฏุงุฏ Environment Variables
```bash
# ูู Coolify ุฃู ููู .env
TELEGRAM_BOT_TOKEN=your_bot_token
GOOGLE_CLIENT_ID=your_client_id
GOOGLE_CLIENT_SECRET=your_client_secret
GOOGLE_DRIVE_FOLDER_ID=your_folder_id

# ุงุฎุชูุงุฑู
TIKTOK_COOKIE=your_cookie
DOWNLOADS_PATH=/custom/path  # ููู Docker
```

### 4๏ธโฃ ุชุดุบูู ุงูุจูุช
```bash
npm start
```

---

## ๐ฑ ุฃูุงูุฑ ุงูุจูุช

### ุงูุฃูุงูุฑ ุงูุฃุณุงุณูุฉ
| ุงูุฃูุฑ | ุงููุตู |
|------|-------|
| `/start` | ุจุฏุก ุงูุจูุช ูุนุฑุถ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ |
| `๐ ูุญุต ุญุงูุฉ ุงูุจุซ` | ุงูุชุญูู ูู ูุฌูุฏ ุจุซ ูุจุงุดุฑ |
| `๐ด ุจุฏุก ุชุณุฌูู ุจุซ` | ุชุณุฌูู ุจุซ ูุจุงุดุฑ |
| `โ๏ธ ุฅุฏุงุฑุฉ ุงููุฑุงูุจุฉ` | ุฅุฏุงุฑุฉ ูุงุฆูุฉ ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ |

### ุฃูุงูุฑ ุงูุชุณุฌููุงุช ุงููุชุนุฏุฏุฉ (NEW!)
| ุงูุฃูุฑ | ุงููุตู |
|------|-------|
| `/list` | ุนุฑุถ ุฌููุน ุงูุชุณุฌููุงุช ุงููุดุทุฉ ูุน ุงููุฏุฉ |
| `/stop <username>` | ุฅููุงู ุชุณุฌูู ูุญุฏุฏ (ูุซุงู: `/stop kio.dz_`) |
| `/stop all` | ุฅููุงู ุฌููุน ุงูุชุณุฌููุงุช ุงููุดุทุฉ |

### ุฃูุงูุฑ ุฅุฏุงุฑุฉ Token
| ุงูุฃูุฑ | ุงููุตู |
|------|-------|
| `/update_token` | ุชุญุฏูุซ Google Drive Refresh Token |
| `/token_status` | ุนุฑุถ ุญุงูุฉ Token ุงูุญุงูู ูุงูุฅุญุตุงุฆูุงุช |

### ุฃูุงูุฑ ุงูููุฏูููุงุช ุงููุงุดูุฉ
| ุงูุฃูุฑ | ุงููุตู |
|------|-------|
| `/failed_videos` | ุนุฑุถ ูุงุฆูุฉ ุงูููุฏูููุงุช ุงูุชู ูุดู ุฑูุนูุง |

---

## ๐ ุฅุนุฏุงุฏ Google Drive Token

### ุงูุทุฑููุฉ ุงูุฃููู: ูู ุงูุชููุฌุฑุงู (ููุตู ุจูุง) โญ
```
1. ุฃุฑุณู /update_token ููุจูุช
2. ุงูุชุญ ุงูุฑุงุจุท ูู ุงููุชุตูุญ
3. ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจ Google
4. ุงููุญ ุงูุตูุงุญูุงุช
5. ุงูุณุฎ ุงูููุฏ
6. ุฃุฑุณู ุงูููุฏ ููุจูุช
7. โ ุชู! ุงูุจูุช ุณูุญูุธ Token ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ูุฏููุงู
```bash
# 1. ุดุบู ุงูุณูุฑูุจุช
node generate-refresh-token.js

# 2. ุงุชุจุน ุงูุฎุทูุงุช ูู ุงูุชุฑููุงู
# 3. ุฃุถู Token ุฅูู Environment Variables:
GOOGLE_REFRESH_TOKEN=1//03xxx...

# 4. ุนูุฏ ุฃูู ุชุดุบููุ ุณูููู Token ุชููุงุฆูุงู ุฅูู DB
```

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ๐ฌ ุณููุงุฑูู 1: ุชุณุฌูู ุนุงุฏู
```
1. ุงุถุบุท "๐ด ุจุฏุก ุชุณุฌูู ุจุซ"
2. ุฃุฑุณู ุงุณู ุงููุณุชุฎุฏู (ูุซู: sifouxgaming)
3. ุงูุจูุช ูุชุญูู ูู ุงูุจุซ ููุจุฏุฃ ุงูุชุณุฌูู
4. ุนูุฏ ุงูุงูุชูุงุกุ ูุฑูุน ุงูููุฏูู ุชููุงุฆูุงู
5. ูุฑุณู ูู ุฑุงุจุท Google Drive
```

### ๐ ุณููุงุฑูู 2: ูุดู ุงูุฑูุน (Token ููุชูู)
```
1. ุงูุชุณุฌูู ููุชูู ุจูุฌุงุญ
2. ูุดู ุงูุฑูุน ุจุณุจุจ ุงูุชูุงุก Token
3. ุงูุจูุช ูุฑุณู ุฅุดุนุงุฑ:
   ๐ ุงูุชูุช ุตูุงุญูุฉ Token
   ๐ ุชู ุญูุธ ุงูููุฏูู
   ๐ ุฑุงุจุท ุงูุชุญุฏูุซ
4. ุชุถุบุท ุนูู ุงูุฑุงุจุท ูุชุฌุฏุฏ Token
5. ุงูุจูุช ูุณุฃูู: "ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุงูุฑูุนุ"
6. ุชุถุบุท "ูุนู"
7. โ ุชู ุฑูุน ุฌููุน ุงูููุฏูููุงุช ุงููุงุดูุฉ
```

### ๐ ุณููุงุฑูู 3: ุนุฑุถ ุงูููุฏูููุงุช ุงููุงุดูุฉ
```
1. ุฃุฑุณู /failed_videos
2. ุงูุจูุช ูุนุฑุถ ูุงุฆูุฉ ุจูู ุงูููุฏูููุงุช:
   ๐ ูุงุฆูุฉ ุงูููุฏูููุงุช ุงููุงุดูุฉ (3)
   
   1๏ธโฃ sifouxgaming_2025-12-04.mp4
      ๐ ุญุฌู: 6.35 MB
      โฐ ุชุงุฑูุฎ: 2025-12-04 10:00
      โ ุณุจุจ: Token expired
      ๐ ูุญุงููุงุช: 1
      [ุฅุนุงุฏุฉ ุฑูุน] [ุญุฐู]
   
3. ููููู:
   - ุฅุนุงุฏุฉ ุฑูุน ููุฏูู ูุงุญุฏ
   - ุฅุนุงุฏุฉ ุฑูุน ุงููู
   - ุญุฐู ููุฏูู ูุงุญุฏ
   - ุญุฐู ุงููู
```

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช (db.json)
```json
{
  "settings": {
    "googleRefreshToken": "1//03xxx...",
    "tokenLastUpdated": "2025-12-04T10:30:00Z",
    "tokenLastUsed": "2025-12-04T11:00:00Z"
  },
  "failedUploads": [
    {
      "id": "sifouxgaming_1733314438000",
      "username": "sifouxgaming",
      "filepath": "/path/to/video.mp4",
      "chatId": 123456,
      "failedAt": "2025-12-04T10:00:00Z",
      "error": "invalid_grant",
      "fileSize": "6.35 MB",
      "attempts": 1
    }
  ],
  "stats": {
    "totalUploads": 45,
    "successfulUploads": 42,
    "failedUploads": 3
  },
  "monitoredUsers": [...]
}
```

### ุชุฏูู ุงูุจูุงูุงุช
```
1. ุงูุชุณุฌูู โ FLV โ ุชุญููู MP4 โ ุญูุธ ูุญููุงู
2. ูุญุงููุฉ ุงูุฑูุน โ Google Drive API
3. ุฅุฐุง ูุฌุญ โ ุญุฐู ุงูููู ุงููุญูู + ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
4. ุฅุฐุง ูุดู โ ุญูุธ ูู failedUploads + ุฅุดุนุงุฑ ุงููุณุชุฎุฏู
5. ุชุญุฏูุซ Token โ ุฅุนุงุฏุฉ ูุญุงููุฉ ุชููุงุฆูุฉ
```

---

## ๐ณ ุงููุดุฑ ุนูู Coolify

### 1๏ธโฃ ุฅุนุฏุงุฏ ุงููุดุฑูุน
```bash
# ูู Coolify Dashboard:
1. ุฃูุดุฆ ุชุทุจูู ุฌุฏูุฏ ูู Git
2. ุงุฎุชุฑ Node.js ูู Buildpack
3. ุฃุถู Environment Variables
```

### 2๏ธโฃ Environment Variables ุงููุทููุจุฉ
```
TELEGRAM_BOT_TOKEN=xxx
GOOGLE_CLIENT_ID=xxx
GOOGLE_CLIENT_SECRET=xxx
GOOGLE_DRIVE_FOLDER_ID=xxx
TIKTOK_COOKIE=xxx (ุงุฎุชูุงุฑู)
```

### 3๏ธโฃ ุฅุนุฏุงุฏ Volume ููููุฏูููุงุช
```
# ูู Coolify:
Volumes โ Add Volume
Name: tiktok-bot-downloads
Mount Path: /var/lib/docker/volumes/xxx/_data

# ุงูุจูุช ุณููุชุดู ุงููุณุงุฑ ุชููุงุฆูุงู
```

### 4๏ธโฃ Deploy
```bash
# Coolify ุณูููู ุจู:
- ุชุซุจูุช Dependencies
- ุชุดุบูู: npm start
- ุฑุจุท ุงูู Volume
```

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### โ "GOOGLE_REFRESH_TOKEN ุบูุฑ ููุฌูุฏ"
**ุงูุญู:** ุงุณุชุฎุฏู `/update_token` ูู ุงูุจูุช

### โ "invalid_grant"
**ุงูุญู:** Token ููุชููุ ุงุณุชุฎุฏู `/update_token`

### โ "ุงูููู ุบูุฑ ููุฌูุฏ" ุนูุฏ ุฅุนุงุฏุฉ ุงูุฑูุน
**ุงูุญู:** ุชู ุญุฐู ุงูููู ูุฏููุงูุ ุงุญุฐูู ูู ุงููุงุฆูุฉ ุจุงุณุชุฎุฏุงู `/failed_videos`

### โ FFmpeg not found
**ุงูุญู:**
```bash
# macOS
brew install ffmpeg

# Linux
apt-get install ffmpeg

# Docker
RUN apt-get update && apt-get install -y ffmpeg
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงููุฑุงูุจุฉ

### ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
```bash
# ุฃุฑุณู /token_status
๐ ุญุงูุฉ Google Drive Token

ุงูุญุงูุฉ: โ ูุดุท
ุขุฎุฑ ุชุญุฏูุซ: 2025-12-04 10:30
ุขุฎุฑ ุงุณุชุฎุฏุงู: 2025-12-04 11:00

๐ ุงูุฅุญุตุงุฆูุงุช:
โ ุฑูุน ูุงุฌุญ: 42
โ ุฑูุน ูุงุดู: 3
๐ฆ ุฅุฌูุงูู: 45

๐ฌ ููุฏูููุงุช ูุงุดูุฉ ุญุงููุงู: 3
```

---

## ๐ ุงูุฃูุงู

### โ ุฃูุถู ุงูููุงุฑุณุงุช ุงููุทุจูุฉ
- Token ูุญููุธ ูู DB ูุญูู (ููุณ ูู Environment Variables)
- ูุง ูุชู ุทุจุงุนุฉ Token ูู ุงูู logs
- ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูุจู ูู ุนูููุฉ ุฑูุน
- ุชูุธูู ุชููุงุฆู ููู OAuth states ุงููุฏููุฉ

### โ๏ธ ููุงุญุธุงุช ุฃูููุฉ
- ูุง ุชุดุงุฑู `db.json` ูุน ุฃุญุฏ
- ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู Token
- ุงุณุชุฎุฏู Google Cloud Console ูู ูุถุน "Production"

---

## ๐ ุงููููุงุช ุงููููุฉ

```
/
โโโ src/
โ   โโโ bot.js                          # ููู ุงูุจูุช ุงูุฑุฆูุณู
โ   โโโ services/
โ   โ   โโโ db.service.js               # ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โ   โโโ drive.service.js            # ุฑูุน Google Drive
โ   โ   โโโ oauth-telegram.service.js   # OAuth ุนุจุฑ ุงูุชููุฌุฑุงู
โ   โ   โโโ tiktok.service.js           # API TikTok
โ   โโโ core/
โ   โ   โโโ recorder.service.js         # ุชุณุฌูู ุงูุจุซ
โ   โ   โโโ monitoring.service.js       # ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ
โ   โโโ utils/
โ       โโโ video.util.js               # ุชุญููู FLV โ MP4
โ       โโโ path.util.js                # ูุณุงุฑุงุช ุฏููุงููููุฉ
โโโ db.json                             # ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ generate-refresh-token.js           # ุณูุฑูุจุช ุชูููุฏ Token
โโโ GOOGLE_OAUTH_GUIDE.md               # ุฏููู OAuth ูุงูู
```

---

## ๐ฏ ุฎุงุฑุทุฉ ุงูุทุฑูู

### โ ุชู ุฅูุฌุงุฒู
- [x] ูุธุงู Token ุฐูู ูู DB
- [x] ูุงุฆูุฉ ุงูุชุธุงุฑ ููููุฏูููุงุช ุงููุงุดูุฉ
- [x] ุฅุนุงุฏุฉ ุฑูุน ุชููุงุฆูุฉ/ูุฏููุฉ
- [x] ุฏุนู Docker/Coolify
- [x] ุฅุญุตุงุฆูุงุช ุดุงููุฉ

### ๐ ูุฑูุจุงู
- [ ] ุถุบุท ุงูููุฏูููุงุช ูุจู ุงูุฑูุน
- [ ] ุฏุนู ุฃูุซุฑ ูู ุญุณุงุจ Google Drive
- [ ] ุฌุฏููุฉ ุชุณุฌูู ุชููุงุฆูุฉ
- [ ] ูุงุฌูุฉ ููุจ ููุฅุฏุงุฑุฉ
- [ ] ุชุดููุฑ Token ูู DB

---

## ๐ค ุงููุณุงููุฉ

ูุฑุญุจ ุจุงููุณุงููุงุช! ุฅุฐุง ูุฌุฏุช ูุดููุฉ ุฃู ูุฏูู ุงูุชุฑุงุญ:
1. ุงูุชุญ Issue
2. ุฃู ูุฏู Pull Request

---

## ๐ ุงูุชุฑุฎูุต

MIT License - ุงุณุชุฎุฏูู ููุง ุชุฑูุฏ!

---

## ๐ฌ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดููุฉ:
1. ุฑุงุฌุน ูุณู "ุงุณุชูุดุงู ุงูุฃุฎุทุงุก" ุฃุนูุงู
2. ุงูุฑุฃ `GOOGLE_OAUTH_GUIDE.md`
3. ุงูุชุญ Issue ุนูู GitHub

---

**ุตููุน ุจู โค๏ธ ูููุทูุฑูู ุงูุนุฑุจ**
